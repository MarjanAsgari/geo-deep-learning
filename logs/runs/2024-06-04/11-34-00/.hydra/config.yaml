model:
  _target_: models.segformer.SegFormer
  encoder: mit_b5
verify:
  output_report_dir: ${general.raw_data_dir}
  output_raster_stats: true
  output_raster_plots: true
  extended_label_stats: true
  multiprocessing: false
  write_dest_raster: ${tiling.write_dest_raster}
tiling:
  tiling_data_dir: ${general.tiling_data_dir}
  train_val_percent:
    trn: 0.7
    val: 0.3
  patch_size: 32
  min_annot_perc: 1
  continuous_values: true
  save_preview_labels: true
  multiprocessing: false
  clahe_clip_limit: 25
  write_dest_raster: false
  write_mode: raise_exists
training:
  num_gpus: 1
  batch_size: 1
  eval_batch_size: null
  batch_metrics: null
  lr: 0.0001
  max_epochs: ${general.max_epochs}
  min_epochs: ${general.min_epochs}
  num_workers: null
  mode: min
  max_used_ram: null
  max_used_perc: null
  state_dict_path: null
  state_dict_strict_load: true
  script_model: false
  compute_sampler_weights: false
loss:
  _target_: segmentation_models_pytorch.losses.SoftBCEWithLogitsLoss
  ignore_index: ${dataset.ignore_index}
  is_binary: true
optimizer:
  _target_: torch.optim.AdamW
  lr: ${training.lr}
  weight_decay: 4.0e-05
callbacks:
  early_stopping:
    class_name: pl.callbacks.EarlyStopping
    params:
      monitor: ${loss}
      patience: 20
      mode: ${training.mode}
  model_checkpoint:
    class_name: pl.callbacks.ModelCheckpoint
    params:
      monitor: ${loss}
      save_top_k: 3
      dirpath: saved_models/
      mode: ${training.mode}
scheduler:
  class_name: torch.optim.lr_scheduler.ReduceLROnPlateau
  step: epoch
  monitor: ${loss}
  params:
    mode: ${training.mode}
    factor: 0.5
    patience: 15
dataset:
  name: null
  raw_data_csv: ${general.raw_data_csv}
  raw_data_dir: /gpfs/fs5/nrcan/nrcan_geobase/work/transfer/work/deep_learning/operationalization/data
  download_data: false
  bands:
  - 1
  - 2
  - 3
  - 4
  attribute_field: properties/class
  attribute_values:
  - 1
  class_name: null
  classes_dict:
    BUIL: 1
  class_weights: null
  ignore_index: 255
augmentation:
  rotate_limit: 45
  rotate_prob: 0.5
  hflip_prob: 0.5
  crop_size: null
  noise: null
  normalization:
    mean: null
    std: null
  scale_data:
  - 0
  - 1
tracker:
  name: mlflow
  run_name: mitb5_hydro_NRGB_planetscope_CSPP_inference
  experiment_name: ${general.project_name}
  uri: /space/partner/nrcan/geobase/work/transfer/work/deep_learning/mlflow/mlruns/
  log: true
visualization:
  vis_at_train: null
  vis_at_evaluation: true
  vis_batch_range:
  - 0
  - 1
  - 1
  vis_at_checkpoint: null
  vis_at_ckpt_min_ep_diff: null
  vis_at_ckpt_dataset: null
inference:
  raw_data_csv: /gpfs/fs5/nrcan/nrcan_geobase/work/transfer/work/deep_learning/models/single/NRGB/hydro/csvs/planetscope_CSSP_NRGB.csv
  root_dir: /gpfs/fs5/nrcan/nrcan_geobase/work/transfer/work/deep_learning/models/single/NRGB/hydro/mitb5_planetscope_CSSP_inference
  input_stac_item: null
  model_path: ${general.save_weights_dir}/
  output_path: null
  checkpoint_dir: null
  batch_size: 8
  chunk_size: 1024
  max_pix_per_mb_gpu: 25
  prep_data_only: false
  override_model_params: false
  save_heatmap: true
  heatmap_threshold: 0.3
  gpu: ${training.num_gpus}
  max_used_perc: ${training.max_used_perc}
  max_used_ram: ${training.max_used_ram}
  ras2vec: true
general:
  task: segmentation
  work_dir: ${hydra:runtime.cwd}
  config_name: ${hydra:job.config_name}
  config_override_dirname: ${hydra:job.override_dirname}
  config_path: ${hydra:runtime.config_sources}
  project_name: planetscope_CSPP_inference
  workspace: your_name
  max_epochs: 2
  min_epochs: 1
  raw_data_dir: data
  raw_data_csv: tests/tiling/tiling_segmentation_binary_ci.csv
  tiling_data_dir: ${general.raw_data_dir}/patches
  save_weights_dir: saved_model/${general.project_name}
print_config: true
mode: inference
debug: true
